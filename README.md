# Infrastructure Pipelines
A way of using terraform and ansible together in a fully automated IaC way using Github-Actions. This allows scaling up and down, building and destroying Kubernetes Clusters
[Tfstate](https://developer.hashicorp.com/terraform/language/state) file for each environment is stored in self-hosted minio-s3 storage. It is recommended to use a [lock](https://developer.hashicorp.com/terraform/language/state/locking) for your state!

## Provision-infra.yml
This pipeline builds an enviroment based on terraform configuration. The pipeline takes **enviroment** as an argument.

## ansible.yml
This pipeline configures hosts to a fully functioning Kubernetes Cluster or Scales up or down accordingly by applying configurations only to the newly created and unconfigured machines. The pipeline takes **enviroment** as an argument.

The inventory file is generated by a python script dynamically following tfstate as a **single source of truth**. for running configurations with ansible i used a tag "**ansible-target**" in terraform's tfstate file so that i can generate a different inventory for the newly created instances. /
**Future Work**: Delete "ansible-target" tag automatically when VMs are configured.

## destory-infra.yml
This pipeline completely destroys an enviroment. The pipeline takes **enviroment** as an argument.